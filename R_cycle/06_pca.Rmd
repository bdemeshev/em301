# Метод главных компонент в R

Метод главных компонент позволяет заменить несколько переменных на меньшее количество с наименьшими потерями информации.


### Частный случай: от двух переменных к одной

Что делает регрессия $y$ на $x$? Строит прямую так, чтобы сумма квадратов вертикальных отклонений точек от прямой была бы минимальна.

Что делает регрессия $x$ на $y$? Строит прямую так, чтобы сумма квадратов горизонтальных отклонений точек от прямой была бы минимальна.

Что делает выделение главной компоненты векторов $x$ и $y$? Строит прямую так, чтобы сумма квадратов отклонений точек от прямой по перпендикуляру была бы минимальна.

### Еще одна трактовка метода главных компонент

Мы хотим вместо $k$ переменных оставить $p<k$. Другими словами, хотим заменить матрицу $X_{n\times k}$ на матрицу $\hat{X}_{n\times k}$ ранга $p$, так чтобы минимизировать сумму квадратов ошибок:
\[
\min \sum_{j=1}^k \sum_{i=1}^n (x_{ij}-\hat{x}_{ij})^2
\]



Загружаем нужные пакеты:
```{r, message=FALSE}
library(knitr)
opts_chunk$set(cache=TRUE) # кэшируем фрагменты кода

library(ggplot2) # для построения графиков
library(HSAUR) # нам нужен только набор данных по многоборью
# install.packages("HSAUR") # может быть нужно установить пакеты...
```

Загружаем интересующий нас набор данных по многоборью:
```{r}
data(heptathlon)
head(heptathlon)
```

Корреляции исходных переменных
```{r}
print(cor(heptathlon),digits=2)
```

Применяем метод главных компонент к исходным, нестандартизированным переменным. Восьмой столбец, `score`, нам не нужен, т.к. это не результат соревнования, а итоговый балл по многоборью. 
```{r}
hept.pca <- prcomp(heptathlon[,-8])
```

Теперь можно раздобыть сами главные компоненты:
```{r}
head(hept.pca$x)
```

Веса исходных переменных в главных компонентнах
```{r}
head(hept.pca$rotation)
```

Посмотрим как первая компонента связана с итоговым результатом спортсмена
```{r}
pc1 <- hept.pca$x[,1]
plot(heptathlon$score,pc1)
cor(heptathlon$score,pc1)
```

Смотрим какую долю дисперсии объясняют главные компоненты:
```{r}
summary(hept.pca)
plot(hept.pca)
```

Внимательно посмотрев на сами данные, замечаем, что они в существенно разных единицах...
```{r}
summary(heptathlon)
```

Значит первая главная компонента ловила прежде всего тот факт, что результаты бега на 800 метров имеют наибольший разброс и ничего больше. Поэтому применим метод главных компонент с предварительной стандартизацией:
```{r}
hept.pca2 <- prcomp(heptathlon[,-8],scale=TRUE)
```

График первых двух компонент с вкладом каждой переменной
```{r}
biplot(hept.pca2)
```

На этом графике видно, например, что:
* Спортсменка Launa из Папуа-Новой Гвинеи не такая как все!
* С ростом результата прыжка в длину, `longjump`, первая главная компонента падает, а вторая --- практически не изменяется.
* Переменные `longjump` и `hurdles` предположительно отрицательно коррелированы, т.к. с ростом первой главной компоненты меняются в разные стороны.




