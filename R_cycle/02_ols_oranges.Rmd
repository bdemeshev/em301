# Апельсины и простая регрессия

```{r}
library(ggplot2) # кузявые графики
```

## Простая работа с данными до оценки регрессий

В R есть куча встроенных наборов данных. Многие пакеты в себе помимо функций содержат также еще и примеры данных. Например, пакет `ggplot2` содержит в себе данные по стоимости бриллиантов `diamonds`.

Список всех наборов данных можно узнать с помощью команды `data()`

```{r}
data()
```

Мы воспользуемся набором про апельсиновые деревья.

Общая информация:
```{r}
h<-Orange
summary(h) # описательные статистики
```

Как выглядит начало таблички?
```{r}
head(h)
```

Структура набора данных. 
```{r}
str(h)
```
Команда `str` --- рабочая лошадка! Пакеты R пишет огромное количество людей, а она позволяет понять, из чего состоит тот или иной объект.


Более подробную информацию о наборе данных про Апельсины ищем у Чебурашки. Чебурашку можно позвать командой `help(Orange)`.

Графики
```{r}
qplot(x=age,y=circumference,data=h,color=Tree)
```


Оценим обыкновенную регрессию
```{r}
model <- lm(circumference~age,data=h) # оцениваем модель
report <-summary(model) # создаём отчет по модели
report # выводим отчет на экран
```

Из результатов оценивания можно вытащить

Ковариационную матрицу, $\hat{\sigma}^2(X'X)^{-1}$:
```{r}
vcov(model)
```

Любимый всеми $R^2$:
```{r}
report$r.squared
```

А также скорректированный $R^2_{adj}$:
```{r}
report$adj.r.squared
```

Коэффициенты:
```{r}
model$coefficients
```

Доверительные интервалы для коэффициентов:
```{r}
confint(model,level=0.90)
```

Построение прогнозов с доверительным интервалом для среднего:
```{r}
new.data<-data.frame(age=c(100,200,300))
predict(model,new.data,interval="confidence")
```

И с предиктивным интервалом:
```{r}
predict(model,new.data,interval="prediction")
```


Что еще можно вытащить из оцененной модели, можно узнать несколькими способами. Например, стоит почитать `help(summary.lm)`. Можно еще набрать в консоли `model$` и пару раз кликнуть `<Tab>`. Еще имеет смысл попробовать нажать `<Tab>` после `summ$`. Можно набрать `str(model)`. Да еще гугл есть.

А вообще бывает полезно изобрести велосипед. Пусть где-то в R уже есть функция, считающая доверительный интервал для прогноза. Если вместо этого написать эту функцию своими руками, то можно получить плюс один к экспириенсу и перейти на следующий уровень.

